{% extends 'base.html' %}

{% block title %}{{ horse.name }} - Cgate{% endblock %}

{% block content %}
<div class="space-y-6">

    <!-- Hero Header -->
    <div class="card p-6">
        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-6">
            <div class="flex items-start gap-6">
                {% if horse.photo %}
                <img src="{{ horse.photo.url }}" alt="{{ horse.name }}" class="w-24 h-24 rounded-xl object-cover shrink-0">
                {% else %}
                <div class="w-24 h-24 rounded-xl bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center shrink-0">
                    <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.429 9.75L2.25 12l4.179 2.25m0-4.5l5.571 3 5.571-3m-11.142 0L2.25 7.5 12 2.25l9.75 5.25-4.179 2.25m0 0L12 12.75 6.429 9.75m11.142 0l4.179 2.25L12 17.25 2.25 12l4.179-2.25"/>
                    </svg>
                </div>
                {% endif %}
                <div class="min-w-0">
                    <div class="flex items-center gap-2 flex-wrap">
                        <h1 class="page-title">{{ horse.name }}</h1>
                        {% if horse.is_active %}
                        <span class="badge-success">Active</span>
                        {% else %}
                        <span class="badge-neutral">Inactive</span>
                        {% endif %}
                        {% if horse.has_passport %}
                        <span class="badge-info">Passport</span>
                        {% endif %}
                    </div>
                    <p class="mt-1 text-sm text-slate-500">
                        {% if horse.calculated_age %}{{ horse.calculated_age }}yo &middot; {% endif %}
                        {{ horse.get_color_display }} &middot;
                        {{ horse.get_sex_display }}
                        {% if horse.date_of_birth %}<span class="ml-1 text-slate-400">(DOB: {{ horse.date_of_birth }})</span>{% endif %}
                    </p>
                    {% if horse.dam or horse.sire_name %}
                    <p class="mt-1 text-xs text-slate-400">
                        {% if horse.sire_name %}Sire: {{ horse.sire_name }}{% endif %}
                        {% if horse.sire_name and horse.dam %} &middot; {% endif %}
                        {% if horse.dam %}Dam: <a href="{% url 'horse_detail' horse.dam.pk %}" class="link text-xs">{{ horse.dam.name }}</a>{% endif %}
                    </p>
                    {% endif %}
                </div>
            </div>
            <div class="flex items-center gap-2 shrink-0">
                <a href="{% url 'horse_move' horse.pk %}" class="btn-success">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"/>
                    </svg>
                    Move Horse
                </a>
                <a href="{% url 'horse_update' horse.pk %}" class="btn-secondary">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"/>
                    </svg>
                    Edit
                </a>
            </div>
        </div>
    </div>

    <!-- Grid Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Left Column -->
        <div class="lg:col-span-2 space-y-6">

            <!-- Current Placement -->
            <div class="card">
                <div class="section-header">
                    <h3 class="section-title">Current Placement</h3>
                </div>
                <div class="p-5">
                    {% if current_placement %}
                    <dl class="grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2">
                        <div>
                            <dt class="text-xs font-medium text-slate-500 uppercase tracking-wider">Location</dt>
                            <dd class="mt-1 text-sm text-slate-900">
                                <a href="{% url 'location_detail' current_placement.location.pk %}" class="link">{{ current_placement.location.name }}</a>
                            </dd>
                        </div>
                        <div>
                            <dt class="text-xs font-medium text-slate-500 uppercase tracking-wider">Owner</dt>
                            <dd class="mt-1 text-sm text-slate-900">
                                <a href="{% url 'owner_detail' current_placement.owner.pk %}" class="link">{{ current_placement.owner.name }}</a>
                            </dd>
                        </div>
                        <div>
                            <dt class="text-xs font-medium text-slate-500 uppercase tracking-wider">Rate</dt>
                            <dd class="mt-1 text-sm text-slate-900">{{ current_placement.rate_type.name }} (&pound;{{ current_placement.rate_type.daily_rate }}/day)</dd>
                        </div>
                        <div>
                            <dt class="text-xs font-medium text-slate-500 uppercase tracking-wider">Arrived</dt>
                            <dd class="mt-1 text-sm text-slate-900">{{ current_placement.start_date }}</dd>
                        </div>
                    </dl>
                    {% else %}
                    <div class="text-center py-6">
                        <svg class="mx-auto h-10 w-10 text-slate-300" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"/>
                        </svg>
                        <p class="mt-2 text-sm text-slate-400">No current placement</p>
                        <a href="{% url 'horse_move' horse.pk %}" class="btn-primary mt-3 inline-flex">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
                            </svg>
                            Add Placement
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Details -->
            <div class="card">
                <div class="section-header">
                    <h3 class="section-title">Details</h3>
                </div>
                <div class="p-5">
                    <dl class="grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2">
                        {% if horse.breeding %}
                        <div class="sm:col-span-2">
                            <dt class="text-xs font-medium text-slate-500 uppercase tracking-wider">Breeding</dt>
                            <dd class="mt-1 text-sm text-slate-900">{{ horse.breeding }}</dd>
                        </div>
                        {% endif %}
                        <div>
                            <dt class="text-xs font-medium text-slate-500 uppercase tracking-wider">Passport</dt>
                            <dd class="mt-1 text-sm text-slate-900">
                                {% if horse.has_passport %}
                                    {% if horse.passport_number %}{{ horse.passport_number }}{% else %}Yes{% endif %}
                                {% else %}
                                    <span class="badge-danger">No passport</span>
                                {% endif %}
                            </dd>
                        </div>
                        <div>
                            <dt class="text-xs font-medium text-slate-500 uppercase tracking-wider">Status</dt>
                            <dd class="mt-1">
                                {% if horse.is_active %}
                                <span class="badge-success">Active</span>
                                {% else %}
                                <span class="badge-neutral">Inactive</span>
                                {% endif %}
                            </dd>
                        </div>
                        {% if horse.notes %}
                        <div class="sm:col-span-2">
                            <dt class="text-xs font-medium text-slate-500 uppercase tracking-wider">Notes</dt>
                            <dd class="mt-1 text-sm text-slate-900">{{ horse.notes }}</dd>
                        </div>
                        {% endif %}
                    </dl>
                </div>
            </div>

            <!-- Worming -->
            <div class="card">
                <div class="section-header">
                    <h3 class="section-title">Worming</h3>
                    <div class="flex items-center gap-2">
                        <a href="{% url 'egg_count_create' %}?horse={{ horse.pk }}" class="btn-ghost btn-xs">+ Egg Count</a>
                        <a href="{% url 'worming_create' %}?horse={{ horse.pk }}" class="btn-ghost btn-xs">+ Treatment</a>
                    </div>
                </div>
                <div class="p-5">
                    <!-- Treatments -->
                    <h4 class="text-sm font-semibold text-slate-700 mb-2">Treatments</h4>
                    {% if worming_treatments %}
                    <div class="overflow-x-auto mb-6">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Product</th>
                                    <th>Active Ingredient</th>
                                    <th>By</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for t in worming_treatments %}
                                <tr>
                                    <td class="text-slate-500">{{ t.date }}</td>
                                    <td class="text-slate-900">{{ t.product_name }}</td>
                                    <td class="text-slate-500">{{ t.active_ingredient|default:"-" }}</td>
                                    <td class="text-slate-500">{{ t.administered_by|default:"-" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-sm text-slate-400 mb-6">No worming treatments recorded</p>
                    {% endif %}

                    <!-- Egg Counts -->
                    <h4 class="text-sm font-semibold text-slate-700 mb-2">Egg Counts</h4>
                    {% if egg_counts %}
                    <div class="overflow-x-auto">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Count (EPG)</th>
                                    <th>Type</th>
                                    <th>Level</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ec in egg_counts %}
                                <tr>
                                    <td class="text-slate-500">{{ ec.date }}</td>
                                    <td class="font-semibold {% if ec.is_high %}text-red-600{% else %}text-slate-900{% endif %}">{{ ec.count }}</td>
                                    <td class="text-slate-500">{{ ec.get_sample_type_display }}</td>
                                    <td>
                                        {% if ec.is_high %}
                                        <span class="badge-danger">High</span>
                                        {% else %}
                                        <span class="badge-success">Normal</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-sm text-slate-400">No egg counts recorded</p>
                    {% endif %}
                </div>
            </div>

            <!-- Medical -->
            <div class="card">
                <div class="section-header">
                    <h3 class="section-title">Medical</h3>
                    <div class="flex items-center gap-2">
                        <a href="{% url 'vet_visit_create' %}?horse={{ horse.pk }}" class="btn-ghost btn-xs">+ Vet Visit</a>
                        <a href="{% url 'condition_create' %}?horse={{ horse.pk }}" class="btn-ghost btn-xs">+ Condition</a>
                    </div>
                </div>
                <div class="p-5">
                    <!-- Conditions -->
                    <h4 class="text-sm font-semibold text-slate-700 mb-2">Conditions</h4>
                    {% if medical_conditions %}
                    <div class="space-y-2 mb-6">
                        {% for c in medical_conditions %}
                        <div class="flex items-center justify-between py-1">
                            <div>
                                <span class="text-sm font-medium text-slate-900">{{ c.name }}</span>
                                {% if c.diagnosed_date %}<span class="text-xs text-slate-400 ml-2">since {{ c.diagnosed_date }}</span>{% endif %}
                            </div>
                            {% if c.status == 'active' %}
                            <span class="badge-danger">Active</span>
                            {% elif c.status == 'monitoring' %}
                            <span class="badge-warning">Monitoring</span>
                            {% else %}
                            <span class="badge-success">Resolved</span>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-sm text-slate-400 mb-6">No medical conditions recorded</p>
                    {% endif %}

                    <!-- Vet Visits -->
                    <h4 class="text-sm font-semibold text-slate-700 mb-2">Vet Visits</h4>
                    {% if vet_visits %}
                    <div class="overflow-x-auto">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Reason</th>
                                    <th>Vet</th>
                                    <th>Follow-up</th>
                                    <th>Cost</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for v in vet_visits %}
                                <tr>
                                    <td class="text-slate-500">{{ v.date }}</td>
                                    <td class="text-slate-900">{{ v.reason|truncatewords:8 }}</td>
                                    <td class="text-slate-500">{% if v.vet %}{{ v.vet.name }}{% else %}-{% endif %}</td>
                                    <td class="{% if v.follow_up_date %}text-amber-600 font-medium{% else %}text-slate-400{% endif %}">{{ v.follow_up_date|default:"-" }}</td>
                                    <td class="text-slate-900">&pound;{{ v.cost|floatformat:2 }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-sm text-slate-400">No vet visits recorded</p>
                    {% endif %}
                </div>
            </div>

            <!-- Breeding (mare only) -->
            {% if horse.is_mare %}
            <div class="card">
                <div class="section-header">
                    <h3 class="section-title">Breeding &amp; Foaling</h3>
                    <a href="{% url 'breeding_create' %}?horse={{ horse.pk }}" class="btn-ghost btn-xs">+ Breeding Record</a>
                </div>
                <div class="p-5">
                    <!-- Active Pregnancy -->
                    {% if active_pregnancy %}
                    <div class="border-l-4 border-amber-400 bg-amber-50/50 rounded-lg p-4 mb-6">
                        <h4 class="text-sm font-semibold text-amber-800 mb-2">Active Pregnancy</h4>
                        <dl class="grid grid-cols-2 gap-2 text-sm">
                            <div>
                                <dt class="text-amber-600 text-xs font-medium">Stallion</dt>
                                <dd class="text-amber-900 font-medium">{{ active_pregnancy.stallion_name }}</dd>
                            </div>
                            <div>
                                <dt class="text-amber-600 text-xs font-medium">Date Covered</dt>
                                <dd class="text-amber-900">{{ active_pregnancy.date_covered }}</dd>
                            </div>
                            {% if active_pregnancy.date_foal_due %}
                            <div>
                                <dt class="text-amber-600 text-xs font-medium">Foal Due</dt>
                                <dd class="text-amber-900 font-medium">{{ active_pregnancy.date_foal_due }}</dd>
                            </div>
                            {% endif %}
                            <div>
                                <dt class="text-amber-600 text-xs font-medium">Status</dt>
                                <dd class="text-amber-900">{{ active_pregnancy.get_status_display }}</dd>
                            </div>
                        </dl>

                        <!-- EHV Schedule -->
                        {% with ehv_dates=active_pregnancy.ehv_vaccination_dates %}
                        {% if ehv_dates %}
                        <div class="mt-3 pt-3 border-t border-amber-200">
                            <h5 class="text-xs font-semibold text-amber-700 uppercase tracking-wider mb-2">EHV Vaccination Schedule</h5>
                            <div class="grid grid-cols-3 gap-2 text-xs">
                                {% for month, date in ehv_dates.items %}
                                <div class="{% if month in active_pregnancy.sent_ehv_months %}bg-green-50 border-green-200{% else %}bg-white border-amber-100{% endif %} border rounded-lg p-2">
                                    <span class="font-medium text-slate-700">Month {{ month }}</span><br>
                                    <span class="text-slate-500">{{ date }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        {% endwith %}
                    </div>
                    {% endif %}

                    <!-- Foals -->
                    {% if foals %}
                    <h4 class="text-sm font-semibold text-slate-700 mb-2">Foals</h4>
                    <div class="overflow-x-auto mb-6">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>DOB</th>
                                    <th>Sex</th>
                                    <th>Colour</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for foal in foals %}
                                <tr>
                                    <td>
                                        <a href="{% url 'horse_detail' foal.pk %}" class="link">{{ foal.name }}</a>
                                    </td>
                                    <td class="text-slate-500">{{ foal.date_of_birth|default:"-" }}</td>
                                    <td class="text-slate-500">{{ foal.get_sex_display }}</td>
                                    <td class="text-slate-500">{{ foal.get_color_display }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}

                    <!-- Breeding History -->
                    {% if breeding_records %}
                    <h4 class="text-sm font-semibold text-slate-700 mb-2">Breeding History</h4>
                    <div class="overflow-x-auto">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Stallion</th>
                                    <th>Covered</th>
                                    <th>Due</th>
                                    <th>Status</th>
                                    <th>Foal</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for br in breeding_records %}
                                <tr>
                                    <td class="text-slate-900">{{ br.stallion_name }}</td>
                                    <td class="text-slate-500">{{ br.date_covered }}</td>
                                    <td class="text-slate-500">{{ br.date_foal_due|default:"-" }}</td>
                                    <td>
                                        {% if br.status == 'confirmed' %}
                                        <span class="badge-info">{{ br.get_status_display }}</span>
                                        {% elif br.status == 'born' %}
                                        <span class="badge-success">{{ br.get_status_display }}</span>
                                        {% elif br.status == 'lost' %}
                                        <span class="badge-danger">{{ br.get_status_display }}</span>
                                        {% else %}
                                        <span class="badge-neutral">{{ br.get_status_display }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if br.foal %}
                                        <a href="{% url 'horse_detail' br.foal.pk %}" class="link">{{ br.foal.name }}</a>
                                        {% else %}<span class="text-slate-400">-</span>{% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-sm text-slate-400">No breeding records</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Placement History -->
            <div class="card">
                <div class="section-header">
                    <h3 class="section-title">Placement History</h3>
                </div>
                <ul class="divide-y divide-slate-100">
                    {% for placement in placements %}
                    <li class="px-5 py-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-slate-900">{{ placement.location.name }}</p>
                                <p class="text-sm text-slate-500">Owner: {{ placement.owner.name }}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-slate-900">{{ placement.start_date }} &ndash; {% if placement.end_date %}{{ placement.end_date }}{% else %}<span class="text-amber-600 font-medium">Present</span>{% endif %}</p>
                                <p class="text-sm text-slate-500">&pound;{{ placement.rate_type.daily_rate }}/day</p>
                            </div>
                        </div>
                    </li>
                    {% empty %}
                    <li class="px-5 py-4 text-sm text-slate-400">No placement history</li>
                    {% endfor %}
                </ul>
            </div>

        </div>

        <!-- Right Column (Sidebar) -->
        <div class="space-y-6">

            <!-- Quick Actions -->
            <div class="card">
                <div class="section-header">
                    <h3 class="section-title">Quick Actions</h3>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-2 gap-2">
                        <a href="{% url 'vaccination_create' %}?horse={{ horse.pk }}" class="card-hover p-3 text-center flex flex-col items-center gap-1.5">
                            <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3"/>
                            </svg>
                            <span class="text-xs font-medium text-slate-600">Vaccination</span>
                        </a>
                        <a href="{% url 'farrier_create' %}?horse={{ horse.pk }}" class="card-hover p-3 text-center flex flex-col items-center gap-1.5">
                            <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17l-5.648 3.203a.75.75 0 01-1.088-.791l1.078-6.29-4.57-4.454a.75.75 0 01.416-1.28l6.317-.917L11.11 0 12 2.25"/>
                            </svg>
                            <span class="text-xs font-medium text-slate-600">Farrier</span>
                        </a>
                        <a href="{% url 'worming_create' %}?horse={{ horse.pk }}" class="card-hover p-3 text-center flex flex-col items-center gap-1.5">
                            <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0"/>
                            </svg>
                            <span class="text-xs font-medium text-slate-600">Worming</span>
                        </a>
                        <a href="{% url 'egg_count_create' %}?horse={{ horse.pk }}" class="card-hover p-3 text-center flex flex-col items-center gap-1.5">
                            <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"/>
                            </svg>
                            <span class="text-xs font-medium text-slate-600">Egg Count</span>
                        </a>
                        <a href="{% url 'condition_create' %}?horse={{ horse.pk }}" class="card-hover p-3 text-center flex flex-col items-center gap-1.5">
                            <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/>
                            </svg>
                            <span class="text-xs font-medium text-slate-600">Condition</span>
                        </a>
                        <a href="{% url 'vet_visit_create' %}?horse={{ horse.pk }}" class="card-hover p-3 text-center flex flex-col items-center gap-1.5">
                            <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span class="text-xs font-medium text-slate-600">Vet Visit</span>
                        </a>
                        {% if horse.is_mare %}
                        <a href="{% url 'breeding_create' %}?horse={{ horse.pk }}" class="card-hover p-3 text-center flex flex-col items-center gap-1.5">
                            <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
                            </svg>
                            <span class="text-xs font-medium text-slate-600">Breeding</span>
                        </a>
                        {% endif %}
                        <a href="{% url 'charge_create' %}?horse={{ horse.pk }}" class="card-hover p-3 text-center flex flex-col items-center gap-1.5">
                            <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75"/>
                            </svg>
                            <span class="text-xs font-medium text-slate-600">Charge</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Vaccinations -->
            <div class="card">
                <div class="section-header">
                    <h3 class="section-title">Vaccinations</h3>
                </div>
                <ul class="divide-y divide-slate-100">
                    {% for vax in vaccinations %}
                    <li class="px-5 py-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-slate-900">{{ vax.vaccination_type.name }}</span>
                            <span class="text-xs text-slate-500">{{ vax.date_given }}</span>
                        </div>
                        <p class="mt-0.5 text-xs {% if vax.is_overdue %}text-red-600 font-medium{% elif vax.is_due_soon %}text-amber-600 font-medium{% else %}text-slate-400{% endif %}">
                            Next: {{ vax.next_due_date }}
                        </p>
                    </li>
                    {% empty %}
                    <li class="px-5 py-4 text-sm text-slate-400">No vaccinations recorded</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Farrier Visits -->
            <div class="card">
                <div class="section-header">
                    <h3 class="section-title">Farrier Visits</h3>
                </div>
                <ul class="divide-y divide-slate-100">
                    {% for visit in farrier_visits %}
                    <li class="px-5 py-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-slate-900">{{ visit.get_work_done_display }}</span>
                            <span class="text-xs text-slate-500">{{ visit.date }}</span>
                        </div>
                        {% if visit.next_due_date %}
                        <p class="mt-0.5 text-xs {% if visit.is_overdue %}text-red-600 font-medium{% elif visit.is_due_soon %}text-amber-600 font-medium{% else %}text-slate-400{% endif %}">
                            Next: {{ visit.next_due_date }}
                        </p>
                        {% endif %}
                    </li>
                    {% empty %}
                    <li class="px-5 py-4 text-sm text-slate-400">No farrier visits recorded</li>
                    {% endfor %}
                </ul>
            </div>

        </div>
    </div>

</div>
{% endblock %}
